<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>添加学历</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="shortcut icon" th:href="./images/favicon.ico" type="image/x-icon">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="renderer" content="webkit">


    <!-- 引入css -->

    <link rel="stylesheet" href="../../layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="../../css/plugins/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <!--<link rel="stylesheet" type="text/css" href="../../layui/layui_exts/layui_ext/dtree/dtree.css">
    <link rel="stylesheet" type="text/css" href="../..//layui_exts/layui_ext/dtree/font/dtreefont.css">-->
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
    <style type="text/css">
        .layui-form-item{
            margin: 10px 0px 10px 0px;
        }
        .layui-form-label {
            width: 130px;
        }
        .layui-input{
            border:1.5px solid #74d2e7;
        }
        .select-test{position: absolute;padding-left:-10px; max-height: 500px;height: 350px;overflow: auto;width: 220px;z-index: 123;display: none;border:1px solid silver;top: 42px;}
        .layui-show{display: block!important;}

    </style>
</head>
<body>
<script src="../../layui/layui.js" charset="utf-8"></script>
<script src="../../js/myJs.js" charset="utf-8"></script>
<script src="../../layui/layui_exts/layui_ext/dtree/dtree.js" charset="utf-8"></script>
<script src="../../lib/layui-v2.3.0/layui.js" charset="utf-8"></script>
<script src="../../js/main.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/plugins/jquery-3.3.1.min.js"></script>
<div class="layui-form timo-compile">
    <form class="layui-form" id="form" >
        <input type="hidden" name="id">
        <div class="layui-form-item">
            <label class="layui-form-label">高校名称</label>
            <div class="layui-input-inline">
                <input class="layui-input" type="text" name="school" id="school" >
            </div>
            <label class="layui-form-label">学历:</label>
            <div class="layui-input-inline">
                <select id="education" name="education">
                      <option>博士</option>
                    <option>硕士</option>
                    <option>高中</option>
                </select>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">起始时间</label>
            <div class="layui-input-inline">
                <input type="text" id="lestartdate" name="lestartdate" placeholder="起始时间"
                       class="layui-input test-item">
            </div>
            <label class="layui-form-label">终止时间</label>
            <div class="layui-input-inline">
                <input type="text" id="leenddate" name="leenddate" placeholder="终止时间"
                       class="layui-input test-item">
            </div>
        </div>


        <div class="layui-form-item">
            <label class="layui-form-label" >一级学科</label>
            <div class="layui-input-inline">
                <input class="layui-input"  type="text" name="sm_name1"  id="sm_name1"  >
            </div>
            <label class="layui-form-label" >二级学科</label>
            <div class="layui-input-inline">
                <input class="layui-input"  type="text" name="sm_name2"  id="sm_name2"  >
            </div>
        </div>
        <div class="layui-form-item timo-finally" align="center">
            <button class="layui-btn" lay-submit="" lay-filter="component-form-demo"style="background-color:#0091cd">添加</button>
        </div>
    </form>
    <div style="position: absolute;top: 30.5%;left: 38%">
        <button class="layui-btn" onclick="saveAll()"style="background-color:#0091cd">保存</button>
    </div>
</div>

<div class="layui-form">
        <table class="layui-table" id="mytable" style="text-align: center;" >
            <tr style="background-color: #0091cd;color: #fff;text-align: center;">
                <th style="width:6%;text-align: center">编号</th>
                <th style="width:14%;text-align: center">起始时间</th>
                <th style="width:14%;text-align: center">终止时间</th>
                <th style="width:14%;text-align: center">高校名称</th>
                <th style="width:19%;text-align: center">学历</th>
                <th style="width:14%;text-align: center">一级学科</th>
                <th style="width:14%;text-align: center">二级学科</th>
                <th style="width:15%;text-align: center">操作</th>
            </tr>
            <tbody id="mytbody">
            </tbody>
        </table>
</div>
<!--获取表单选中的值动态添加到表格中-->
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
<script>
    layui.use(['table','form','laydate','jquery'],function () {
        var table = layui.table,
            $ = layui.$,
            form = layui.form;

       id=location.href.split("?")[1].split("=")[1];
       /* pname=location.href.split("?")[2].split("=")[2];*/
        alert(id);
      /*  alert(pname);*/
        //监听添加
        form.on('submit(component-form-demo)',function (data) {
            doctorId = $("#mytable").find("tr").length;
            var education = document.getElementById("education").options[document.getElementById("education").selectedIndex].text;
            /*var smName1 = document.getElementById("sm_name2").value;
            var smName2 = document.getElementById("sm_name2").value;*/

            /*var tr = table.insertRow();
            tr.height = 36;*/
            var addtr = $("<tr>" +
                "<td>" + doctorId + "</td>" +
                "<td name='lestartdate'>" + data.field.lestartdate + "</td>" +
                "<td name='leenddate'>" + data.field.leenddate + "</td>" +
                "<td name='school'>" + data.field.school + "</td>" +
                "<td name='education'>" + education + "</td>" +
                "<td name='sm_name1'>" + data.field.sm_name1 + "</td>" +
                "<td name='sm_name2'>" + data.field.sm_name2 + "</td>" +
              /*  "<td name='dRemark' style='display: none'>" + data.field.dRemark + "</td>" +*/
                "<td><a class='layui-btn' href=\"javascript:;\" onclick=\"del(this)\">删除</a></td>" +
                "</tr>");

            addtr.appendTo('#mytable');
            document.getElementById("form").reset();
            return false;
        });

    });

    //删除一行后排序不变
    function del(tr){
        layer.confirm('您确定删除吗？',{title:'温馨提示',skin: 'layui-layer-molv'},function(){
            var doctorId=$(tr).parent().parent().find("td:eq(0)").text();//获取当前的编号
            var num2=$(tr).parent().parent().nextAll("tr").length;//获取当前元素后的同级元素个数
            if(num2>0){
                for(i=0;i<num2;i++){ //循环将后面的数字减去1
                    var doctorId=$(tr).parent().parent().nextAll("tr").find("td:eq(0)").eq(i).text();
                    $(tr).parent().parent().nextAll("tr").find("td:eq(0)").eq(i).text(parseInt(doctorId)-1);
                }
            }
            layer.msg("删除成功")
            $(tr).parent().parent().remove()
        });
    }
    //保存到数据库
    function saveAll() {
        var learningexperience = new Array();
        var length = $("#mytable").find("tr").length - 1;
        //循环tr原素
        for (i = 1; i <= length; i++) {
            var obj = {};
            for (j = 1; j <= 7; j++) {
                var td = $("#mytable").find("tr").eq(i).children("td").eq(j);
                obj[$(td).attr('name')] = $(td).text();
            }
            learningexperience.push(obj);
            alert(learningexperience);
        }

        layer.confirm('您确定添加吗？',{title:'温馨提示',skin: 'layui-layer-molv'},function(){
            $.ajax({
                type: "POST",
                traditional: true,
                url: '/learningexperience/addAllDoctor',
                    data: JSON.stringify({"learningexperienceList":learningexperience}),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function () {
                    var index = parent.layer.getFrameIndex(window.name);
                    parent.layer.close(index);
                    parent.window.location.reload();
                },
                error: function () {
                    alert("insert serv wrong");
                }
            });
        });
    }
</script>
<script>
   /* //学科平台目录树
    spmTree();
    //学科目录树
    smTree();
    //高校名称下拉框
    schoolSelect();
    //高校联动显示高校代码
    siIdSelect();
    //年选择器
    timeData();*/
</script>
</body>
</html>