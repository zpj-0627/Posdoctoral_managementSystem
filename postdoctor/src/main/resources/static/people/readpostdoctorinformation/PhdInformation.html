<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <title>基本信息</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="../../css/plugins/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="../../layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="../../css/main.css" media="all">
    <link rel="stylesheet" type="text/css" href="../../layui/layui_exts/layui_ext/dtree/dtree.css">
    <link rel="stylesheet" type="text/css" href="../../layui/layui_exts/layui_ext/dtree/font/dtreefont.css">
    <style>
        .layui-form-label {
            width: 212px;
        }
         .layui-input{
             border:1.5px solid #74d2e7;
         }
        .select-test{position: absolute;padding-left:-10px; max-height: 500px;height: 350px;overflow: auto;width: 240px;z-index: 123;display: none;border:1px solid silver;top: 42px;}

       /* .layui-form-item {
            margin: 0px;
        }
        .layui-input-inline {
            margin: 0px;

        }
        .layui-form-label {
            padding:2px 0px;
            width: 60px;
            !* line-height: 24px; *!
            background: #74d2e7;

            !*font-size: 15px;*!
        }
        .layui-input {
            width: 80%;
            background: #74d2e7;
        }*/
        /*.select-test{position: absolute;max-height: 500px;height: 350px;overflow: auto;width: 235px;z-index: 123;display: none;border:1px solid silver;top: 42px;}
        .layui-show{display: block!important;}*/
    </style>
</head>
<body>
<script type="text/javascript" src="../../layui/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/main.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/myJs.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/phdInfo.js" charset="utf-8"></script>
<script type="text/javascript" src="../../js/plugins/jquery-3.3.1.min.js"></script>
<div class="layui-form timo-compile">
    <!--添加表单元素-->
    <form class="layui-form" action="" lay-filter="component-form-group" id="component-form-group">
        <input type="hidden" name="pId" id="pId">
        <div class="layui-form-item">
            <label class="layui-form-label" >博士学位论文题目<span class="required"> *</span></label>
            <div class="layui-input-inline">
                <input id="dDissertationTopic" class="layui-input"  type="text" name="dDissertationTopic" lay-verify="required" style="width:730px;" >
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" >博士论文指导老师</label>
            <div class="layui-input-inline">
                <input class="layui-input"  type="text" name="dThesisAdvisor" id="dThesisAdvisor" >
            </div>
            <label class="layui-form-label" >是否已取得博士学位证书<span class="required"> *</span></label>
            <div class="layui-input-inline"  >
                <select id="dDegreeCertificate" name="dDegreeCertificate" >
                    <option>是</option>
                    <option>否</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" >博士证书签发时间<span class="required"> *</span></label>
            <div class="layui-input-inline">
                <input type="text" id="ddcSignDate" name="ddcSignDate" readonly="" class="layui-input test-item"
                       lay-verify="required" >
            </div>
            <label class="layui-form-label" >博士学位论文答辩通过时间<span class="required"> *</span></label>
            <div class="layui-input-inline">
                <input type="text" id="ddDefenseDate" name="ddDefenseDate" readonly="" class="layui-input test-item"
                       lay-verify="required" >
            </div>
        </div>
        <div class="layui-form-item ">
            <label class="layui-form-label" >获得博士学位国别(地区)<span class="required"> *</span></label>
            <div class="layui-input-inline">
                <select id="dDegreeNationality" name="dDegreeNationality" >
                </select>
            </div>
            <label class="layui-form-label" >博士毕业单位<span class="required"> *</span></label>
            <div class="layui-input-inline">
                <input class="layui-input"  type="text" name="dDoctoralUnit"  id="dDoctoralUnit"  >
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" >获博士学位一级学科<span class="required"> *</span></label>
            <div class="layui-input-inline">
                <select id="dSmName1" name="dSmName1" >
                </select>
            </div>
            <label class="layui-form-label" >获博士学位二级学科</label>
            <div class="layui-input-inline">
                <select id="dSmName2" name="dSmName2" >
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" >博士论文摘要(字数1000以内)<span class="required"> *</span></label>
            <div class="layui-input-inline" >
                <input id="ddAbstract" class="layui-input"  type="text" name="ddAbstract" style=" width:730px;height: 76px">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label" >科研成果奖励和荣誉称号(字数1000以内)</label>
            <div class="layui-input-inline">
                <input id="srHoners" class="layui-input"  type="text" name="srHoners"  style=" width:730px;height: 76px">
            </div>
        </div>
        <div class="layui-form-item timo-finally" align="center">
            <button class="layui-btn" lay-submit="" lay-filter="component-form-demo" style="background-color: #0091cd">保存</button>
        </div>

    </form>
</div>
<script>
    layui.use(['table','form','laydate','jquery'], function(){
        var laydate = layui.laydate;
            $ = layui.$,
            form = layui.form;
    lay('.test-item').each(function(){
        laydate.render({
            elem: this,
            type: 'date',
            theme: 'grid',
            trigger: 'click',
        });
    });
        id=location.href.split("?")[1].split("=")[1]
        $.get('/phdinformation/getText/'+id,function (r) {
            $('[name=pId]').val(r.pid)
            $('[name=dDissertationTopic]').val(r.ddissertationTopic)
            $('[name=dThesisAdvisor]').val(r.dthesisAdvisor)
            $('[name=dDegreeCertificate]').val(r.ddegreeCertificate)
            $('[name=ddcSignDate]').val(r.ddcSignDate)
            $('[name=ddDefenseDate]').val(r.ddDefenseDate)
            // $('[name=dDegreeNationality]').val(r.dDegreeNationality)
            $('[name=dDoctoralUnit]').val(r.ddoctoralUnit)
            /*$('[name=dSmName1]').val(r.dSmName1)
            $('[name=dSmName2]').val(r.dSmName2)*/
            $('[name=ddAbstract]').val(r.ddAbstract)
            $('[name=srHoners]').val(r.srHoners)
            layui.form.render('select');
            //博士学位一级学科下拉框
            selectPostfsub(r);
            //博士学位二级学科下拉框
            selectPostssub(r);
            //国别下拉框
            selectPCountry(r);
            form.on('submit(component-form-demo)',function (data) {
                /*var siId = document.getElementById("school").options[document.getElementById("school").selectedIndex].value;*/
                var pId = document.getElementById("pId").value;
                var dDissertationTopic = document.getElementById("dDissertationTopic").value;
                var dThesisAdvisor = document.getElementById("dThesisAdvisor").value;
                var dDegreeCertificate = document.getElementById("dDegreeCertificate").options[document.getElementById("dDegreeCertificate").selectedIndex].text;
                var ddcSignDate = document.getElementById("ddcSignDate").value;
                var ddDefenseDate = document.getElementById("ddDefenseDate").value;
                var dDegreeNationality = document.getElementById("dDegreeNationality").options[document.getElementById("dDegreeNationality").selectedIndex].text;
                var dDoctoralUnit= document.getElementById("dDoctoralUnit").value;
                var dSmName1 = document.getElementById("dSmName1").options[document.getElementById("dSmName1").selectedIndex].text;
                var dSmName2 = document.getElementById("dSmName2").options[document.getElementById("dSmName2").selectedIndex].text;
                var ddAbstract = document.getElementById("ddAbstract").value;
                var srHoners = document.getElementById("srHoners").value;

                if (dDissertationTopic==r.ddissertationTopic&&dThesisAdvisor==r.dthesisAdvisor&&dDegreeCertificate==r.ddegreeCertificate&&ddcSignDate==r.ddcSignDate&&ddDefenseDate==r.ddDefenseDate&&dDegreeNationality==r.ddegreeNationality&&dDoctoralUnit==r.ddoctoralUnit&&dSmName1==r.dsmName1
                    &&dSmName2==r.dsmName2&&ddAbstract==r.ddAbstract&&srHoners==r.srHoners) {
                    layer.msg('并没有修改信息',{icon: 5, shade: 0.5, time: 1500});
                }else {
                    var json1 = $('form').serialize();
                    $.post(
                        "/phdinformation/update",
                        json1,
                        function (res) {
                            if (res){
                                layer.msg("修改成功", {icon: 6, shade: 0.5, time: 1500}, function () {
                                    var index = parent.layer.getFrameIndex(window.name);
                                    parent.layer.close(index);
                                    parent.window.location.reload();
                                })
                            }else {
                                layer.msg("修改失败",{icon: 5, shade: 0.5, time: 1500});
                            }
                        },'json');
                }

                return false;
            });
        },'json');
    });



</script>
</body>
</html>